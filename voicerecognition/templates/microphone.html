<!DOCTYPE html>
<html>
<head>
    <title>Запись и отправка речи</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 500px;
            margin: 50px auto;
        }

        .btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Запись и отправка речи</h2>
        <button id="record-button" class="btn">Записать</button>
        <button id="stop-button" class="btn" disabled>Остановить</button>
    </div>

    <script>
        var recordButton = document.getElementById('record-button');
        var stopButton = document.getElementById('stop-button');
        var mediaRecorder;
        var chunks = [];

        recordButton.addEventListener('click', startRecording);
        stopButton.addEventListener('click', stopRecording);

        function startRecording() {
            recordButton.disabled = true;
            stopButton.disabled = false;
            chunks = [];

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/wav' });

                    mediaRecorder.addEventListener('dataavailable', function(e) {
                        chunks.push(e.data);
                    });

                    mediaRecorder.start();
                })
                .catch(function(error) {
                    console.error('Ошибка при получении доступа к микрофону:', error);
                    recordButton.disabled = false;
                    stopButton.disabled = true;
                });
        }

        function stopRecording() {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(function(track) {
                track.stop();
            });

            var blob = new Blob(chunks, { type: 'audio/wav' });
            var formData = new FormData();
            formData.append('audio', blob);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/speech-to-text', true);

            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        alert('Файл успешно отправлен на сервер');
                    } else {
                        alert('Ошибка при отправке файла: ' + xhr.responseText);
                    }
                    recordButton.disabled = false;
                    stopButton.disabled = true;
                }
            };

            xhr.send(formData);
        }
    </script>
</body>
</html>
